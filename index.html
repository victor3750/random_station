<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>隨機抽取台灣火車站</title>
    <link rel="stylesheet" href="cssReset.css">
    <style>
        html { background: #F7F7F7; color: #3E3E3E; }
        body { font-family: Arial, sans-serif; text-align: center; height: 100vh; padding: 60px 30px 0; }
        .title { font-size: 40px; font-weight: 700; }
        .result { font-size: 32px; margin-top: 20px; }
        button {border-radius: 8px; border: solid 1px #3E9A9F; background: #fff; padding: 10px 20px; font-size: 1.5em; cursor: pointer; box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.10), 0px 1px 2px 0px rgba(0, 0, 0, 0.15); }
        #drawBtn { font-size: 40px; font-weight: 700; 
            background: linear-gradient(90deg,#f9b237,#f9d769); 
            box-shadow: 2px 2px 12px rgba(239,164,44,.3); border: none; color: #fff;
            margin-top: 20px;
        }
        #drawBtn:hover { background: #fff; color: #f9b237; box-shadow: inset 0 0 0 2px #f9b237; }
        .city-buttons { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px; }
        .city-buttons button { width: 120px; } /* 四個按鈕一排 */
        .selectAllLabel { display: block; margin-top: 20px; }
        .selected { background-color: #3E9A9F; color: white; } /* 被選擇的按鈕樣式 */
        .random_station { color: #1C4A4C; font-weight: bold; }
        .shake { animation: shake 0.3s infinite; } /* 震動效果 */
        @keyframes shake { 
            0% { transform: translateX(0); } 
            25% { transform: translateX(-10px); } 
            50% { transform: translateX(10px); } 
            75% { transform: translateX(-10px); } 
            100% { transform: translateX(0); } 
        } /* 震動動畫 */

        @media screen and (max-width: 600px) {
            body { padding: 40px 20px 0; }
            .title { font-size: 24px; }
            #drawBtn { font-size: 24px; }
            .city-buttons button { font-size: 16px; width: 80px; padding: 6px 8px; }
            .result { font-size: 20px; }
        }
    </style>
</head>
<body>
    <h1 class="title">隨機抽取台灣火車站</h1>

    
    <button id="drawBtn">抽取車站</button>
    <div class="result" id="stationResult">請選擇縣市並抽取車站</div>
    
    <!-- 全選勾選框 -->
    <label class="selectAllLabel">
        <input type="checkbox" id="selectAllCheckbox"> 全選
    </label>

    <div class="city-buttons">
        <button data-city="基隆市">基隆市</button>
        <button data-city="臺北市">臺北市</button>
        <button data-city="新北市">新北市</button>
        <button data-city="桃園市">桃園市</button>
        <button data-city="新竹市">新竹市</button>
        <button data-city="新竹縣">新竹縣</button>
        <button data-city="苗栗縣">苗栗縣</button>
        <button data-city="臺中市">臺中市</button>
        <button data-city="彰化縣">彰化縣</button>
        <button data-city="南投縣">南投縣</button>
        <button data-city="雲林縣">雲林縣</button>
        <button data-city="嘉義市">嘉義市</button>
        <button data-city="嘉義縣">嘉義縣</button>
        <button data-city="臺南市">臺南市</button>
        <button data-city="高雄市">高雄市</button>
        <button data-city="屏東縣">屏東縣</button>
        <button data-city="宜蘭縣">宜蘭縣</button>
        <button data-city="花蓮縣">花蓮縣</button>
        <button data-city="臺東縣">臺東縣</button>
    </div>

    <script>
        let allStations = [];
        let selectedCities = new Set(); // 用來存放被選擇的縣市
        let filteredStations = [];

        // 使用 fetch 讀取 JSON 檔案
        fetch('stations.json')
            .then(response => response.json())
            .then(data => {
                allStations = data; // 儲存所有車站資料
            })
            .catch(error => console.error('Error loading JSON:', error));

        const drawBtn = document.getElementById('drawBtn');
        const stationResult = document.getElementById('stationResult');
        const cityButtons = document.querySelectorAll('.city-buttons button');
        const selectAllCheckbox = document.getElementById('selectAllCheckbox');

        // 點擊縣市按鈕事件
        cityButtons.forEach(button => {
            button.addEventListener('click', () => {
                const city = button.getAttribute('data-city');
                
                // 切換選中狀態
                if (selectedCities.has(city)) {
                    selectedCities.delete(city);
                    button.classList.remove('selected');
                } else {
                    selectedCities.add(city);
                    button.classList.add('selected');
                }
                
                updateFilteredStations();
            });
        });

        // 全選或取消全選
        selectAllCheckbox.addEventListener('change', (event) => {
            const isChecked = event.target.checked;

            cityButtons.forEach(button => {
                const city = button.getAttribute('data-city');
                
                if (isChecked) {
                    selectedCities.add(city);
                    button.classList.add('selected');
                } else {
                    selectedCities.clear();
                    button.classList.remove('selected');
                }
            });

            updateFilteredStations();
        });

        // 更新 filteredStations 陣列
        function updateFilteredStations() {
            filteredStations = allStations.filter(station => {
                return selectedCities.has(station.stationAddrTw.split('市')[0] + '市') ||
                       selectedCities.has(station.stationAddrTw.split('縣')[0] + '縣');
            }).map(station => station.stationName);
        }

        // 抽取車站邏輯
        drawBtn.addEventListener('click', () => {
            if (filteredStations.length > 0) {
                let duration = 4500; // 總持續時間為4.5秒
                let interval = 50; // 初始間隔時間
                let startTime = Date.now();

                function showRandomStation() {
                    const randomIndex = Math.floor(Math.random() * filteredStations.length);
                    const randomStation = filteredStations[randomIndex];
                    stationResult.innerHTML = `抽到的車站是：<span class="random_station">${randomStation}</span>`;

                    let elapsedTime = Date.now() - startTime;
                    if (elapsedTime < duration) {
                        // 計算下一次間隔時間，使速度逐漸變慢
                        interval *= 1.07;
                        setTimeout(showRandomStation, interval);
                    } else {
                        // 抽取完畢後加上左右抖動動畫
                        stationResult.classList.add('shake');
                        setTimeout(() => {
                            stationResult.classList.remove('shake');
                        }, 500); // 抖動動畫持續0.5秒
                    }
                }

                showRandomStation();
            } else {
                stationResult.innerHTML = '請選擇至少一個縣市。';
            }
        });
    </script>
</body>
</html>